From 478832809fc5f7a0beb2e1e4ed5e39c255fd892d Mon Sep 17 00:00:00 2001
From: Johannes Schindelin <johannes.schindelin@gmx.de>
Date: Mon, 15 Jul 2019 13:19:29 +0200
Subject: [PATCH 3/3] Fix compile issues with GCC v9.x

Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
---
 src/child.c    | 4 ++--
 src/term.c     | 2 +-
 src/termout.c  | 2 +-
 src/winclip.c  | 8 ++++----
 src/wininput.c | 6 +++---
 src/winmain.c  | 2 +-
 src/wintext.c  | 2 +-
 7 files changed, 13 insertions(+), 13 deletions(-)

diff --git a/src/child.c b/src/child.c
index 0189ab1..50657a2 100644
--- a/src/child.c
+++ b/src/child.c
@@ -890,7 +890,7 @@ user_command(wstring commands, int n)
         // check for multi-line separation
         if (*cmdp == '\\' && cmdp[1] == '\n') {
           cmdp += 2;
-          while (isspace(*cmdp))
+          while (isspace((uchar)*cmdp))
             cmdp++;
         }
       }
@@ -1229,7 +1229,7 @@ child_launch(int n, int argc, char * argv[], int moni)
         // check for multi-line separation
         if (*cmdp == '\\' && cmdp[1] == '\n') {
           cmdp += 2;
-          while (isspace(*cmdp))
+          while (isspace((uchar)*cmdp))
             cmdp++;
         }
       }
diff --git a/src/term.c b/src/term.c
index eae1ace..ae242a8 100644
--- a/src/term.c
+++ b/src/term.c
@@ -1374,7 +1374,7 @@ struct emoji_base {
   void * res;  // filename (char*/wchar*) or cached image
   uint tags: 11;
   xchar ch: 21;
-} __attribute__((packed));
+};
 
 struct emoji_base emoji_bases[] = {
 #include "emojibase.t"
diff --git a/src/termout.c b/src/termout.c
index 385ea14..7f7233d 100644
--- a/src/termout.c
+++ b/src/termout.c
@@ -869,7 +869,7 @@ cfg_apply(char * conf, char * item)
       // check for multi-line separation
       if (*cmdp == '\\' && cmdp[1] == '\n') {
         cmdp += 2;
-        while (isspace(*cmdp))
+        while (isspace((uchar)*cmdp))
           cmdp++;
       }
     }
diff --git a/src/winclip.c b/src/winclip.c
index d8cc155..adc95c6 100644
--- a/src/winclip.c
+++ b/src/winclip.c
@@ -112,7 +112,7 @@ static int wsl_fstab_len = 0;
 static char *
 skip(char * s)
 {
-  while (isspace(*s))
+  while (isspace((uchar)*s))
     s++;
   return s;
 }
@@ -163,12 +163,12 @@ wslmntmapped(void)
         char * p1 = skip(linebuf);
         if (*p1 != '#') {
           char * x = p1;
-          while (!isspace(*x))
+          while (!isspace((uchar)*x))
             x++;
           *x++ = 0;
           char * p2 = skip(x);
           x = p2;
-          while (!isspace(*x))
+          while (!isspace((uchar)*x))
             x++;
           *x = 0;
           if (x-- > p2 && *x == '/')
@@ -787,7 +787,7 @@ matchconf(char * conf, char * item)
       // check for multi-line separation
       if (*cmdp == '\\' && cmdp[1] == '\n') {
         cmdp += 2;
-        while (isspace(*cmdp))
+        while (isspace((uchar)*cmdp))
           cmdp++;
       }
     }
diff --git a/src/wininput.c b/src/wininput.c
index b8c3476..1eb340c 100644
--- a/src/wininput.c
+++ b/src/wininput.c
@@ -163,7 +163,7 @@ append_commands(HMENU menu, wstring commands, UINT_PTR idm_cmd, bool add_icons,
     // check for multi-line separation
     if (*cmdp == '\\' && cmdp[1] == '\n') {
       cmdp += 2;
-      while (isspace(*cmdp))
+      while (isspace((uchar)*cmdp))
         cmdp++;
     }
   }
@@ -586,7 +586,7 @@ win_update_menus(bool callback)
       // check for multi-line separation
       if (*cmdp == '\\' && cmdp[1] == '\n') {
         cmdp += 2;
-        while (isspace(*cmdp))
+        while (isspace((uchar)*cmdp))
           cmdp++;
       }
     }
@@ -1700,7 +1700,7 @@ pick_key_function(wstring key_commands, char * tag, int n, uint key, mod_keys mo
       // check for multi-line separation
       if (*cmdp == '\\' && cmdp[1] == '\n') {
         cmdp += 2;
-        while (isspace(*cmdp))
+        while (isspace((uchar)*cmdp))
           cmdp++;
       }
     }
diff --git a/src/winmain.c b/src/winmain.c
index 726b5ba..dd55e4c 100644
--- a/src/winmain.c
+++ b/src/winmain.c
@@ -3656,7 +3656,7 @@ enum_commands(wstring commands, CMDENUMPROC cmdenum)
       // check for multi-line separation
       if (*cmdp == '\\' && cmdp[1] == '\n') {
         cmdp += 2;
-        while (isspace(*cmdp))
+        while (isspace((uchar)*cmdp))
           cmdp++;
       }
     }
diff --git a/src/wintext.c b/src/wintext.c
index 3fe8e10..737f5e1 100644
--- a/src/wintext.c
+++ b/src/wintext.c
@@ -2106,7 +2106,7 @@ scale_to_image_ratio()
   printf("  cur w %d h %d img bw %d bh %d\n", (int)w, (int)h, bw, bh);
 #endif
 
-  if (abs(bw * h - bh * w) < w + h)
+  if (abs((int)bw * h - (int)bh * w) < w + h)
     return;
 
   w = max(w, ini_width);
-- 
2.22.0

